<!DOCTYPE html>
<!-- saved from url=(0071)https://subwayblaze.com/ext/ca?iid=dca51f13-83c1-49b8-9d92-a889f274b372 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width">
    <title></title>
    <script src="./jquery.min.js.download"></script>
    <script type="text/javascript">
        function createCookie(name, value, seconds) {
            var date = new Date();
            var expires = "";
            if (seconds > 0) {
                date.setTime(date.getTime() + (seconds * 1000));
                expires = "; expires=" + date.toGMTString();
            }
            else {
                date.setTime(date.getTime() + (60 * 60 * 1000));
                expires = "; expires=" + date.toGMTString();
            }
            document.cookie = name + "=" + value + expires + "; path=/";
        }
        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        function removeCookie(name) {
            document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
        }
        $(document).ready(function() {
            window.addEventListener("message", receiveMessage, false);
            function receiveMessage(event) {
                if (!event || !event.data) return;

                if (event.data == "ext-pcg-pp2-lastupdate")
                {
                    createCookie(event.data, Date.now(), 120);                              // expires after 2 mins
                    createCookie("ext-pcg-day-pp2-lastupdate", Date.now(), 24 * 60 * 60);   // expires after 24 hours
                }
                else if (event.data == "ext-pcg-ta-lastupdate")
                {
                    createCookie(event.data, Date.now(), 60);
                    createCookie("ext-pcg-day-ta-lastupdate", Date.now(), 24 * 60 * 60);
                }
                else if (event.data == "ext-pcg-pp-lastupdate")
                {
                    createCookie(event.data, Date.now());
                    createCookie("ext-pcg-day-pp-lastupdate", Date.now(), 24 * 60 * 60);
                }
                else if (event.data == "ext-pcg-first-active") {
                    var firstActive = readCookie("ext-pcg-first-active");
                    if (!firstActive) {
                        createCookie(event.data, Date.now());
                    }

                    var lastActive = readCookie("ext-pcg-last-active");
                    if (lastActive && Date.now() - parseInt(lastActive) > 10 * 60 * 1000) { // idle more than 10 mins, reset first active
                        createCookie(event.data, Date.now());
                        //console.log("update first active")
                    } else {
                        var timeSinceLastActive = (Date.now() - parseInt(lastActive)) /1000;
                        //console.log("no update first active. seconds since last active: " + timeSinceLastActive);
                    }

                    //update last active time
                    createCookie("ext-pcg-last-active", Date.now());
                }
                else if (event.data == "ext-pcg-tu-lastupdate") {
                    createCookie(event.data, Date.now(), 60);
                    createCookie("ext-pcg-day-tu-lastupdate", Date.now(), 24 * 60 * 60);
                }
            }

            window.postMessage('ext-pcg-first-active', "*");

            // pop2 - store in obj array
            var pop2WindowID = 0;
            var pop2Limit = 1;
            var installPK = 21889363;
            var lastPPTimestamp = 0;
            var lastPP2Timestamp = 0;
            var lastTATimestamp = 0;

            setInterval(function() {
                var pop = readCookie("ext-pcg-pp-lastupdate");
                if (pop && Date.now() - parseInt(pop) < 60 * 1000) {
                    parent.postMessage('ext-pcg-pp-exist', "*");
                } else {
                    parent.postMessage('ext-pcg-pp-not-exist', "*");
                }

                if (pop2WindowID > 0) {
                    // find existing pop or create new and then keep updating pop date
                    var pop2CookieString = readCookie("ext-pcg-pp2-arr-lastupdate") != null && readCookie("ext-pcg-pp2-arr-lastupdate").startsWith('[{') ? readCookie("ext-pcg-pp2-arr-lastupdate") : "[]";
                    var pop2CookieObj = JSON.parse(pop2CookieString);
                    var existingPop = pop2CookieObj.find(function (p) { return p.id == pop2WindowID; });
                    if (!!existingPop) {
                        existingPop.date = Date.now();
                    }
                    else {
                        var newPop = { id: pop2WindowID, date: Date.now() };
                        pop2CookieObj.push(newPop);
                    }
                    var pop2String = JSON.stringify(pop2CookieObj);
                    createCookie("ext-pcg-pp2-arr-lastupdate", pop2String);
                }

                var pop2 = readCookie("ext-pcg-pp2-lastupdate");            // pop2 - 2 mins cookie created right after a new pop
                var pop2Arr = readCookie("ext-pcg-pp2-arr-lastupdate");     // pop2 - array of pop2's windowID and last update datetime (keep updating if pop is not closed)
                var pop2CookieObj = JSON.parse(pop2Arr);
                var pop2ExistCount = 0;
                if (Array.isArray(pop2CookieObj))
                    pop2CookieObj.forEach(function(item, index, arr) {
                        // check last update of each pop2
                        //console.log(item.id + ' ' + item.date + ' ' + index + ' ' + arr[index].date + ' now:' + Date.now());
                        if ((Date.now() - parseInt(item.date)) < 1 * 60 * 1000)
                        {
                            pop2ExistCount++;
                        }
                    });

                if (!!pop2 || pop2ExistCount >= pop2Limit) {
                    parent.postMessage('ext-pcg-pp2-exist', "*");
                } else {
                    parent.postMessage('ext-pcg-pp2-not-exist', "*");
                }

                // post last pop/pop2/tab timestamp as message to parent window
                lastPPTimestamp = readCookie("ext-pcg-day-pp-lastupdate");
                lastPP2Timestamp = readCookie("ext-pcg-day-pp2-lastupdate");
                lastTATimestamp = readCookie("ext-pcg-day-ta-lastupdate");
                if (lastPPTimestamp > 0)
                    parent.postMessage('{"lastPPTimestamp":"' + lastPPTimestamp + '"}', "*");
                if (lastPP2Timestamp > 0)
                    parent.postMessage('{"lastPP2Timestamp":"' + lastPP2Timestamp + '"}', "*");
                if (lastTATimestamp > 0)
                    parent.postMessage('{"lastTATimestamp":"' + lastTATimestamp + '"}', "*");

                var tuef = readCookie("ext-pcg-tuef-lastupdate");
                if (tuef && Date.now() - parseInt(tuef) < 60 * 1000) {
                    parent.postMessage('ext-pcg-tuef-exist', "*");
                } else {
                    parent.postMessage('ext-pcg-tuef-not-exist', "*");
                }

                var firstActive = readCookie("ext-pcg-first-active");
                var lastActive = readCookie("ext-pcg-last-active");
                var sessionInSecond = (Date.now() - firstActive) / 1000;
                var isSesionGreaterThanFirstDelay = sessionInSecond > 60;       // first delay rule

                // keep updating ta/tu cookie value, if ta/tu window is active
                var taWindowID = 0;
                var tuWindowID = 0;
                if (taWindowID > 0)
                    createCookie("ext-pcg-ta-lastupdate", Date.now(), 60);
                if (tuWindowID > 0)
                    createCookie("ext-pcg-tu-lastupdate", Date.now(), 60);

                // post msg to other window about ta/tu exist status
                var ta = readCookie("ext-pcg-ta-lastupdate");
                var secondSinceLastTA = (Date.now() - parseInt(ta)) / 1000;
                var canTaNow = secondSinceLastTA > 60;                                 // TA interval rule

                if (!isSesionGreaterThanFirstDelay) {
                    parent.postMessage('ext-pcg-ta-exist', "*");
                } else {
                    if (!ta || (ta && canTaNow)) {
                        parent.postMessage('ext-pcg-ta-not-exist', "*");
                    } else {
                        parent.postMessage('ext-pcg-ta-exist', "*");
                    }
                }

                // tab under
                var tu = readCookie("ext-pcg-tu-lastupdate");
                var secondSinceLastTU = (Date.now() - parseInt(tu)) / 1000;
                var canTuNow = secondSinceLastTU > 60;

                if (!isSesionGreaterThanFirstDelay) {
                    parent.postMessage('ext-pcg-tu-exist', "*");
                } else {
                    if (!tu || (tu && canTuNow)) {
                        parent.postMessage('ext-pcg-tu-not-exist', "*");
                    } else {
                        parent.postMessage('ext-pcg-tu-exist', "*");
                    }
                }
            }, 2000);
        });
    </script>
</head>
<body style="">
    <div>
        test
    </div>


</body></html>